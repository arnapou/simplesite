
stages:
  - test


.job-test: &job-test
  stage: test
  only:
    - master
  script:
    - composer install --no-interaction --optimize-autoloader --quiet
    - vendor/bin/psalm --no-cache
#    - sudo -u www-data vendor/bin/phpunit
  cache:
    key: "$CI_COMMIT_REF_SLUG:$CI_JOB_NAME"
    paths:
      - vendor

test:php-8.1:
  <<: *job-test
  image: 'registry.gitlab.com/arnapou/docker/php:8.1-cron'
